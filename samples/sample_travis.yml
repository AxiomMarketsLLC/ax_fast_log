# .travis.yml
# sudo: false
language: cpp

notifications:
  email: false
  slack: axiommarkets:uQPCDh2hZ26jzOx3TyWEnpDe

compiler:
  - g++

before_install:
  - pip install --user cpp-coveralls
  - pip install --user pyyaml
  - sudo apt-get -y install gdb
  - pwd
  - ls
  - mkdir logs

install:
  - ulimit -c unlimited -S
  
script:
  - make test
  - ./tomahawk.tests --log_level=test_suite

after_failure:
  - ls
  - COREFILE=$(find ./ -maxdepth 1 -name "core" | head -n 1)
  - if [[ -f "$COREFILE" ]]; then gdb -c "$COREFILE" tomahawk.tests -ex "thread apply all bt" -ex "set pagination 0" -batch; fi
  
after_success:
  - coveralls --exclude boost --exclude tests --gcov-options 'src/*.cpp -o'
